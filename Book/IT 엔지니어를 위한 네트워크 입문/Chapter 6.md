
# 📚 로드 밸런서\/방화벽 : 4계층 장비(세션장비)

## 📌 4계층 장비의 특징

### 세션 장비

- 4계층 이상에서 동작하는 로드 밸런서, 방화벽과 같은 장비
- 세션 장비는 세션 테이블 기반으로 운영
- 세션 정보를 저장, 확인하는 전반 작업에 대한 이해가 필요
- 세션 정보는 세션 테이블에 남아 있는 라이프타임이 존재

## 📌 로드 밸런서

### 로드 밸런서

- 서버나 장비의 부하를 분산하기 위해 사용하는 장비
- 트래픽을 분배해주는 기능

### L4 스위치

- 4계층에서 동작하면서 로드 밸런서 기능이 있는 스위치
- 내부 동작 방식은 4계층 로드 밸런서이지만 외형은 스위치처럼 여러 개의 포트를 가지고 있다.
- 부하 분산, 성능 최적화, 리다이렉션 기능을 제공

### ADC

- 애플리케이션 계층에서 동작하는 로드 밸런서
- 애플리케이션 프로토콜의 헤더와 내용을 이해하고 동작 => 다양한 부하 분산, 정보 수정, 정보 필터링이 가능
- 대부분의 ADC는 4계층에서 애플리케이션 계층까지 로드 밸런싱 기능을 제공하고 Failover, Redirection 기능도 함께 수행
- 캐싱, 압축, 콘텐츠 변환 및 재작성, 인코딩 변환, 애플리케이션 프로토콜 최적화

### 시스템 확장 방법

|  비고    | 스케일 업(Scale-Up) | 스케일 아웃(Scale-Out) |
|------| ----------------------------------------------------------------------- | ---------------------- |
| 설명 | 하드웨어 성능 자체를 업그레이드 or 더 높은 성능의 시스템으로 마이그레이션 | 여러 대의 서버로 로드를 분산 |
| 장점 | 시스템 설계 변경 없이 서비스 사용량을 쉽게 늘릴수 있다. | 적은 비용, 결함허용 구현 |
| 단점 | 부품 추가의 어려움, 비용이 기하급수적으로 증가 | 복합한 아키텍쳐를 이해하고 운영, 분산을 위한 프로세스나 네트워크 장비가 추가로 필요 | 

## 📌 방화벽

### 방화벽

- 네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 정책 조건에 맞추어 허용하거나 차단하는 장비

## 📌 4계층 장비를 통과할 때의 유의점(세션 관리)

### 세션 테이블 유지, 세션 정보 동기화

- 세션 장비와 애플리케이션의 세션 유지시간 차이를 극복하기 위한 방법
    - 세션 장비 운영자 입장
    1. 세션 장비의 세션 만료 시간 증가
    2. 세션 시간을 둔 채로 중간 패킷을 수용할 수 있도록 방화벽 설정
    3. 세션 장비에서 세션 타임아웃 시 양 단말에 세션 종료 통보
    - 개발자 입장
    1. 애플리케이션에서 주기적인 패킷 발생 기능 추가

### 비대칭 경로 문제

- 인바운드 패킷과 아웃바운드 패킷의 경로가 다를때 생기는 문제 
- 해결방법
    1. 방화벽끼리 세션 테이블을 동기화
    2. 세션 장비에서 경로 보정

### 하나의 통신에 두 개 이상의 세션이 사용될때의 고려사항

- 현대 프토토콜은 하나의 통신을 위해 한 개의 세션만 사용하는 경우가 대부분.  
하지만 특별한 목적으로 두 개 이상의 세션을 만드는 경우가 있음.  
=> 이런 경우 세션 장비도 서로 다른 두 세션이 하나의 통신을 위해 사용하고 있다는 것을 파악해야 함  
=> 파악하지 못하면 단방향 통신이나 통신하지 못할 수 있음.
    
    
