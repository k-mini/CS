
# 📚 통신을 도와주는 네트워크 주요 기술

## 📌 NAT/PAT

### NAT(Network Address Translation, 네트워크 주소 변환)

- 네트워크 주소를 변환하는 기술
- 사설 IP <-> 공인 IP, 사설 IP <-> 다른 사설 IP

### PAT(Port Address Translation, NAPT, Network Address Port Translation)

- 1:N, N:1, N:M 주소 변환
- IP와 포트번호 이용해 변환
- SNAT만 적용

### NAT\/PAT 필요성

- IPv4 주소 고갈문제의 솔루션으로 NAT 사용
- 보안 강화 => 외부에 사내IP 주소 체계를 숨길 수 있다.
- IP 주소 체계가 같은 두 개의 네트워크 간 통신을 가능 => 사설 IP는 외부와 통신할 때 공인IP로 변환되어 통신하므로 서로 다른 회사에서 중복해 사용 가능
- 불필요한 설정 변경을 줄일 수 있다.  
=> 사용자가 NAT\/PAT를 이용해 내부 네트워크를 구성하고 있었다면 서버와 PC의 IP 주소 변경 없이 회선과 IDC 사업자 이전이 가능.  
=> 내부 네트워크 설정은 변경할 필요없고, DNS 서비스나 NAT를 수행하는 네트워크 장비 설정만 변경하면되므로 변경 최소화. 

### SNAT(Source NAT)와 DNAT(Destination NAT)

- 트래픽이 출발하는 시작 시점을 기준으로 구분
- SNAT : 출발지 주소를 변경하는 NAT
- DNAT : 도착지 주소를 변경하는 NAT

### SNAT와 DNAT는 어떤 경우에 사용?

- SNAT : 사설에서 공인으로 통신할 때, 보안상 SNAT를 사용할 때
- DNAT : 로드 밸런서 => 사용자가 서비스 요청을 위해 로드 밸런서에 설정된 서비스 VIP로 서비스를 요청할 때,  
  대외망에 NAT 장비를 이용해 대외사의 IP를 특정 IP 대역으로 NAT할 때

### 정적 NAT

- 출발지와 목적지 IP를 미리 매핑해 고정해놓은 NAT

### 동적 NAT

- 출발지나 목적지 어느 경우든 사전에 정해지지 않고 NAT를 수행할 때 IP를 동적으로 변경하는 것
- 다수의 IP 풀에서 정해지므로 최소한 출발지나 목적지 중 한 곳이 다수의 IP로 구성된 IP 풀이나 레인지로 설정되어 있다.


## 📌 DNS

### DNS

- 도메인 주소를 IP 주소로 변환하는 역할

### DNS구조

- 도메인은 계층 구조
- www.naver.com. => www(Third-Level Domain), naver(Second_Level Domain), com(Top-Level Domain),  .(root)

### DNS 동작 방식

1. 도메인을 쿼리 => DNS 서버에 쿼리를 하기 전 로컬에 있는 DNS 캐시 정보를 먼저 확인 => DNS 캐시 정보: 동적 DNS 캐시 + 정적 DNS 캐시(hosts파일)
2. 캐시에 없으면 DNS 서버에 쿼리
3. DNS 서버는 루트 DNS에 쿼리
4. 루트 DNS에서는 TLD값(com)을 관리하는 DNS가 어디인지 응답.
5. DNS 서버는 TLD값(com)을 관리하는 DNS에게 naver.com에 대해 쿼리
6. TLD DNS 서버가 naver.com을 관리하는 DNS 응답
7. DNS 서버가 naver.com 관리 DNS에게 쿼리하고 naver.com에 대한 정보 받음

### 마스터와 슬레이브

- DNS 서버는 마스터 서버와 슬레이브 서버로 나뉜다.
- 마스터 서버가 우선순위가 더 높지 않고 두 서버 모두 도메인 쿼리에 응답
- 마스터 서버 : 도메인 영역을 생성하고 레코드를 직접 관리
- 슬레이브 서버 : 마스터 서버에 설정된 도메인이 가진 레코드값을 정기적으로 복제 (영역 전송)

### DNS 주요 레코드

| 레코드 종류 | 내용 |
| ----------- | ---- |
| A(IPv4 호스트) | 도메인 주소를 IP 주소(IPv4)로 매핑 |
| AAAA(IPv6 호스트) | 도메인 주소를 IP 주소(IPv6)로 매핑 |
| CNAME(별칭) | 도메인 주소에 대한 별칭 |
| SOA(권한 시작) | 본 영역 데이터에 대한 권한 |
| NS(도메인의 네임서버) | 본 영역에 대한 네임 서버 |
| MX(메일 교환기) | 도메인에 대한 메일 서버 정보(Mail eXchanger) |
| PTR(포인터) | IP 주소를 도메인에 매핑(역방향) |
| TXT(레코드) | 도메인에 대한 일반 텍스트 |

### A 레코드

- 도메인 주소를 IP 주소로 변환
- 동일한 도메인을 가진 A 레코드를 여러 개 만들어 서로 다른 IP 주소와 매핑할 수 있다.
- 반대로 다수의 도메인에 동일한 IP를 매핑한 A 레코드도 만들 수 있다.

### AAAA 레코드

- IPv6 주소 체계에서의 A 레코드

### CNAME(Canonical Name) 레코드

- 네임 서버가 CNAME 레코드에 대한 질의를 받으면 CNAME 레코드는 설정된 도메인 정보를 확인하고 그 도메인 정보를 내부적으로 다시 질의한 결과IP 값을 응답.

### SOA(Start Of Authority) 레코드

- 도메인 영역에 대한 권한을 나타내는 레코드
- 현재 네임 서버가 이 도메인 영역에 대한 관리 주체임을 의미하므로 해당 도메인에 대해서는 다른 네임 서버에 질의하지 않고 응답
- 현재 도메인 관리에 필요한 속성값을 설정 (도메인 동기화에 필요한 타이머 값이나 TTL 값, 네임 서버, 관리자 정보)

### NS(Name Server) 레코드

- 도메인에 대한 권한이 있는 네임 서버 정보를 설정하는 레코드
- 권한이 있는 네임 서버 정보를 해당 도메인에 설정하는 역할
- 하위 도메인에 대한 권한을 다른 네임 서버로 위임하는 역할

### MX(Mail eXChange) 레코드

- 메일 서버를 구성할 때 사용되는 레코드
- 해당 도메인을 메일 주소로 갖는 메일 서버를 MX 레코드를 통해 선언

### PTR(Pointer) 레코드

- A 레크도와 반대로 IP 주소에 대한 질의를 도메인 주소로 응답하기 위한 레코드
- 역방향 조회용 레코드
- A 레코드와는 달리 하나의 IP 주소에 대해 하나의 도메인 주소만 가질 수 있음. (하나의 IP에 대한 PTR 레코드는 오직 하나만 가진다.)

### TXT(TeXT) 레코드

- 간단한 텍스트를 입력할 수 있는 레코드

### 도메인 위임(DNS Delegation)

- 도메인 내의 모든 레코드를 그 네임 서버가 직접 관리하지 않고 일부 영역에 대해서는 다른 곳에서 레코드를 관리
- 아래 예시는 'A' DNS서버에서 post라는 영역의 관리 권한을 'B' GSLB로 넘겨주는 경우

| 레코드 | 관리 주체 |
| ------ | --------- |
| zigispace.net | 'A' DNS |
| blog.zigispace.net | 'A' DNS |
| b.blog.zigispace | 'A' DNS |
| post.zigispace.net | 'B' GSLB |
| c.post.zigispace.net | 'B' GSLB |

### TTL(Time To Live)

- DNS에 질의해 응답받은 결괏값을 캐시에서 유지하는 시간

### 화이트 도메인

- 정상적인 도메인을 인증,관리하는 제도
- KISA RBL 사이트에서 화이트 도메인 등록 가능 => 사전에 해당 도메인에 SPF 레코드가 설정되어 있어야 함
- SPF 레코드를 통해 사전에 메일 서버 정보를 공개
- 수신 측 에서는 해당 도메인을 통해 발송된 메일이 실제 메일 서버에 등록된 정보와 일치하는지 확인  
=> 일치하면 정상, 불일치하면 비정상적인 전송으로 간주하여 스팸 처리

## 📌 GSLB

### GSLB(Global Server\/Service Load Balancing)

- 동일한 레코드 이름으로 서로 다른 IP 주소를 동시에 설정할 수 있다.
- 도메인을 이용한 로드 밸런싱 구현을 도와준다.
- 등록된 도메인에 대한 서비스가 정상인지를 체크해 정상인 레코드만 사용
- 서비스가 정상적인지 헬스 체크를 수행
- '인텔리전스 DNS'라고도 부른다.
- 일반 DNS는 두 개 이상의 항목이 있을때 헬스 체크와 부하 분산을 고려하지 않고 단순히 라운드 로빈(순서대로 순환)방식으로 응답

### GSLB 구성방식

- 도메인 자체를 GSLB 사용 => 모든 레코드에 대한 질의가 GSLB를 통해 이루어지므로 GSLB 부하가 크다.
- 도메인 내의 특정 레코드만 GSLB 사용
    - 별칭 사용 (CNAME)  
    => CDN처럼 GSLB를 운영해주는 외부 사업자, GSLB를 사용해야 하는 도메인이 매우 많은 경우 별도의 GSLB를 운영하기 위해 사용
    - 위임 사용 (NS 레코드 사용)  
    => DNS와 같은 도메인으로 GSLB 운영하면서 계층적으로 GSLB를 이용한 FQDN을 관리할 때 사용 

### GSLB 분산 방식

- 서비스 제공의 가능 여부를 체크해 트래픽 분산
- 지리적으로 멀리 떨어진 다른 데이터 트래픽 분산 (지리적으로 멀리 떨어진 곳은 트래픽을 적게보내거나 안보낸다는 의미??)
- 지역적으로 가까운 서비스에 접속해 더 빠른 서비스 제공이 가능하도록 분산

## 📌 DHCP

### DHCP

- IP를 동적으로 할당하는 데 사용되는 프로토콜
- DHCP를 사용하면 직접 입력해야 하는 IP 주소, 서브넷 마스크, 게이트웨이, DNS 정보를 자동으로 할당받아 사용

### DHCP 동작 방식

1. DHCP Discover  
=> DHCP 클라이언트는 DHCP 서버를 찾기 위해 DHCP Dicover 메시지를 브로드캐스트 전송

2. DHCP Offer  
=> DHCP Discover를 수신한 DHCP 서버는 클라이언트에 할당할 IP 주소와 서브넷, 게이트웨이, DNS 정보,  
Lease Time 등의 정보를 포함한 DHCP 메세지를 클라이언트로 전송 (브로드캐스트)

3. DHCP Request  
=> DHCP 서버로부터 제안받은 IP 주소와 DHCP 서버 정보를 포함한 DHCP 요청 메세지를 브로드캐스트로 전송

4. DHCP Acknowledgement  
=> DHCP 클라이언트로부터 IP 주소를 사용하겠다는 요청을 받으면 DHCP 서버에 해당 IP를 어떤 클라이언트가  
언제부터 사용했는지 정보를 기록하고 DHCP Request 메세지를 정상적으로 수신했다는 응답을 전송 (브로드캐스트)


### DHCP 서버 구성

- IP 주소 풀(IP 범위)
- 예외 IP 주소 풀(예외 IP 범위)
- 임대 시간
- 서브넷 마스크
- 게이트웨이
- DNS

### DHCP 릴레이 에이전트

- 배경 : DHCP 클라이언트와 DHCP 서버 간에 전송되는 패킷은 모두 브로드캐스트이다 => 브로드캐스트는 동일 네트워크끼리만 전송가능  
=> 각 네트워크마다 DHCP 서버 필요 => 낭비
- DHCP 릴레이 에이전트가 DHCP 패킷을 동일 네트워크 대역에서 수신하면, DHCP 서버로 갈 수 있도록 유니캐스트로 변환(중간자 역할) 
- DHCP 서버 한 대로 여러 네트워크 대역에서 IP 풀을 관리할 수 있다.
- 즉, DHCP 서버를 네트워크마다 구성 하지 않고 중앙 DHCP 서버만으로도 여러 네트워크에서 DHCP 환경을 운영할 수 있다.


