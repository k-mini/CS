
# 📚 교착 상태

## 📌 교착 상태의 개요

### 교착 상태(dead lock)

- 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태

### 교착 상태의 발생

- 시스템 자원 ex) 프린터, CD 레코더
- 공유 변수 ex) 임계구역 문제를 해결하기 위한 공유 변수
- 응용 프로그램 ex) 데이터베이스 같은 응용 프로그램

## 📌 교착 상태 필요조건

### 교착 상태 발생 조건

- 상호 배제 => 한 프로세스가 사용하는 자원은 다른 프로세스와 공유할 수 없는 배타적인 자원이어야 함
- 비선점    => 한 프로세스가 사용중인 자원은 중간에 다른 프로세스가 빼앗을 수 없는 비선점 자원이어야 함
- 점유와 대기 => 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태
- 원형 대기 => 점유와 대기를 하는 프로세스 간의 관계가 원을 이루어야 함
- 4가지 조건을 모두 충족해야 교착상태가 발생

## 📌 교착 상태 해결 방법

### 교착 상태 해결 방법

| 해결 방법 | 특징 |
| -- | -- |
| 교착 상태 예방 | 교착 상태를 유발하는 4가지 조건을 무력화 |
| 교착 상태 회피 | 교착 상태가 발생하지 않는 수준으로 자원 할당량을 조절 |
| 교착 상태 검출 | 자원 할당 그래프를 사용하여 교착 상태를 발견 |
| 교착 상태 회복 | 교착 상태를 검출한 후 해결 |

### 상호 배제 예방

- 독점적인 자원을 없애면 예금 등의 독점적으로 사용해야하는 자원에서 문제가 생기므로 사실상 어렵다.

### 비선점 예방

- 임계구역을 보호하기 위해 잠금을 사용하면 자원을 빼앗을 수 없을 뿐만 아니라 상호 배제도 못쓰게 보장할 수 없다. (임계구역 해결조건 1. 상호배제 2. 한정대기 3. 진행의 융통성)

### 점유와 대기 예방

- 전부 할당하거나 아니면 아예 할당하지 않는 바익
- 자원이 아닌 프로세스의 자원 사용 방식을 변화시켜 교착 상태를 처리
- 단점
  - 프로세스가 자신이 사용하는 모든 자원을 자세히 알기 어렵다.
  - 자원의 활용성이 떨어진다.
  - 많은 자원을 사용하는 프로세스가 적은 자원을 사용하는 프로세스보다 불리하다.
  - 결국 일괄 작업 방식으로 동작

### 원형 대기 예방

- 점유와 대기를 하는 프로세스들이 원형을 이루지 못하도록 막는다. ex) 모든 자원에 숫자를 부여하고 숫자가 큰 방향으로만 자원을 할당
- 단점
    - 프로세스 작업 진행에 유연성이 떨어진다. ex) 프린터(3)를 사용한 다음 마우스(1)를 할당받으려는데 운영체제에서 이를 거부
    - 자원의 번호를 어떻게 부여할 것인지가 문제이다.

### 교착 상태 회피

- 할당 되는 자원의 수를 조절
- 은행원 알고리즘
- 단점(한계)
    - 프로세스가 자신이 사용할 모든 자원을 미리 선언 => 각 프로세스가 자원을 미리 선언해야 하는데 쉽지 않음
    - 시스템의 전체 자원수가 고정적이어야 함 => 그러나 시스템은 일시적인 고장이나 새로운 자원이 추가되므로 유동적 
    - 자원이 낭비 => 모든 불안정 상태가 교착 상태가 되는 것은 아닌데도 불구하고 자원을 할당하지 않음
### 은행원 알고리즘

| 변수 | 설명 |
| -- | -- |
| 전체 자원 | 시스템 내 전체 자원의 수 |
| 가용 자원 | 시스템 내 현재 사용할 수 있는 자원의 수(가용 자원 = 전체 자원 - 모든 프로세스의 할당 자원) |
| 최대 자원 | 각 프로세스가 선언한 최대 자원의 수 |
| 할당 자원 | 각 프로세스가 현재 할당된 자원의 수 |
| 기대 자원 | 각 프로세스가 앞으로 사용할 자원의 수(기대 자원 = 최대 자원 - 할당 자원) | 

- 안정 상태 : 가용 자원 >= 기대 자원 인 경우가 각 프로세스중 한 번 이상인 경우

### 교착 상태 검출

- 타임아웃 
    - 일정 시간 동안 작업이 진행되지 않으면 교착상태로 간주하여 처리
    - 엉뚱한 프로세스가 강제 종료
    - 모든 시스템에 적용할 수 없음 ex) 분산 데이터베이스 => 타임아웃이 교착상태, 네트워크 문제, 단순히 처리가 늦는지 파악 불가
- 자원 할당 그래프
    - 오버헤드 발생

### 교착 상태 회복

- 교착 상태 일으킨 모든 프로세스 동시 종료
- 교착 상태 일으킨 프로세스 중 하나를 골라 순서대로 종료

## 📌 [심화] 다중 자원과 교착 상태 검출

- 다중 자원이 포함된 자원할당 그래프에서는 대기 그래프와 그래프 감소 방법을 이용하여 사이클을 찾음









